<%
  page_data(
    title: "Processing a group of ECTs",
    error: @pending_induction_submission_batch.errors.present?,
    backlink_href: new_ab_batch_action_path,
  )
%>

<%=
  govuk_summary_list(card: { title: 'Progress' }, rows: [
    {
      key: { text: 'Batch ID' },
      value: { text: @pending_induction_submission_batch.id }
    },
    {
      key: { text: 'Batch status' },
      value: { text: govuk_tag(text: @pending_induction_submission_batch.batch_status) }
    },
    {
      key: { text: 'Batch type' },
      value: { text: govuk_tag(text: @pending_induction_submission_batch.batch_type) }
    },    
    {
      key: { text: 'Batch error' },
      value: { text: @pending_induction_submission_batch.error_message }
    },
    {
      key: { text: 'Number of CSV rows' },
      value: { text: @pending_induction_submission_batch.rows.count }
    },
    {
      key: { text: 'Number of processed submission records' },
      value: { text: @pending_induction_submission_batch.processed_rows.count }
    },
  ])
%>

<%=
  govuk_table(
    caption: "CSV raw data (#{@pending_induction_submission_batch.rows.count} rows)",
    head: @pending_induction_submission_batch.csv_headings.values,
    rows: @pending_induction_submission_batch.rows,
  )
%>

<%=
  govuk_table(
    caption: "Processed data (#{@pending_induction_submission_batch.processed_rows.count} rows)",
    head: @pending_induction_submission_batch.processed_headers,
    rows: @pending_induction_submission_batch.processed_rows,
  )
%>

<%=
  govuk_table(
    caption: "Download data (#{@pending_induction_submission_batch.csv_download.count} rows)",
    head: @pending_induction_submission_batch.csv_headings.values,
    rows: @pending_induction_submission_batch.csv_download,
  )
%>

<%= govuk_button_link_to 'Download CSV', ab_batch_action_path(@pending_induction_submission_batch, format: :csv) %>