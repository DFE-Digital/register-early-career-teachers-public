<% page_data(title: @response.description, caption: @request.description, breadcrumbs: @breadcrumbs) %>

<p>
  The status code from ECF was <strong><%= status_code_tag(@response.ecf_status_code) %></strong>  
  and the response took <strong><%= number_with_delimiter(@response.ecf_time_ms) %>ms</strong>.
</p>

<p>
  The status code from RECT was <strong><%= status_code_tag(@response.rect_status_code) %></strong>  
  and the response took <strong><%= number_with_delimiter(@response.rect_time_ms) %>ms</strong>.
</p>

<p>
  The response bodies were <strong><%= comparison_in_words(@response.bodies_matching?) %></strong> and RECT had 
  <strong><%= performance_gain(@response.rect_performance_gain_ratio) %></strong> performance when compared to ECF.
</p>

<p>
  The response IDs were <strong><%= comparison_in_words(@response.body_ids_matching?) %></strong>. In total
  RECT returned <strong><%= id_count_in_words(@response.rect_body_ids) %></strong> and ECF returned <strong><%= id_count_in_words(@response.ecf_body_ids) %></strong>.
</p>

<% if @response.bodies_different? || @response.body_ids_different? %>
  <% content_for(:head) do %>
    <style type="text/css" nonce="<%= content_security_policy_nonce %>"><%= Diffy::CSS %></style>
  <% end %>

  <%= govuk_details(summary_text: "Understanding the differences") do %>
    <p>
      The diff below highlights what has changed between the ECF and RECT response bodies.
    </p>
    
    <p>
      Sections <span class="diff red">in red</span> show content that exists 
      in the ECF response but is missing from the RECT response.
    </p>

    <p>
      Sections <span class="diff green">in green</span> show content that exists 
      in the RECT response but is missing from the ECF response.
    </p>
  <% end %>
<% end %>

<% if @response.bodies_different? %>
  <hr class="govuk-section-break govuk-section-break--l">

  <h2 class="govuk-heading-l">Response body</h2>

  <div class="govuk-grid-row diff-container">
    <div class="govuk-grid-column-one-third">
      <%= render partial: "filter", locals: { filter: @filter } if @filter.filterable? %>
    </div>
    <div class="govuk-grid-column-two-thirds">
      <%= render partial: "body_diff", locals: { response: @filter.filtered_response } %>
    </div>
  </div>
<% end %>

<% if @response.body_ids_different? %>
  <hr class="govuk-section-break govuk-section-break--l">

  <h2 class="govuk-heading-l">Response IDs</h2>

  <div class="govuk-grid-row diff-container">
    <div class="govuk-grid-column-one-third">
      <p>
        There <%= "was".pluralize(@response.ecf_only_body_ids.count) %> <span class="diff red"><%= id_count_in_words(@response.ecf_only_body_ids) %></span>
        returned by ECF that were not returned by RECT.
      </p>

      <p>
        There <%= "was".pluralize(@response.rect_only_body_ids.count) %> <span class="diff green"><%= id_count_in_words(@response.rect_only_body_ids) %></span>
        returned by RECT that were not returned by ECF.
      </p>
    </div>
    <div class="govuk-grid-column-two-thirds">
      <%= render partial: "body_ids_diff", locals: { response: @response } %>
    </div>
  </div>
<% end %>
